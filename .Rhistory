spatialGreeneRF <- spatialRF::rf_spatial(
data = greendatacen_spdf,
dependent.variable.name = "Pre_mortality",
predictor.variable.names = c("Green_avail", "SHDiv", "Income_Sco", "Crime_Scor", "Barriers_H", "PM10", "density_pp","bikefac_dist_new", "ffood_dist", "gpp_dist_a", "NightLightmean", "RNoiseLmedian", "LSTSummer17mean"),
distance.matrix = distance_matrix,
distance.thresholds = 0, #here we selected zero as in non-spatial model we found at multiple thresholds they all show auto-correlation
method = "mem.moran.sequential", #default method, you can select other methods too such as mem.effect.recursive, check help for details
ranger.arguments = list( #this part we keep same as non-spatial model
mtry = 3,
min.node.size = 5,
num.trees = 500
),
verbose = FALSE,
n.cores = parallel::detectCores() - 2,
seed = random.seed
)
random.seed <- set.seed(123)
#Spatial RF
spatialGreeneRF <- spatialRF::rf_spatial(
data = greendatacen_spdf,
dependent.variable.name = "Pre_mortality",
predictor.variable.names = c("Green_avail", "SHDiv", "Income_Sco", "Crime_Scor", "Barriers_H", "PM10", "density_pp","bikefac_dist_new", "ffood_dist", "gpp_dist_a", "NightLightmean", "RNoiseLmedian", "LSTSummer17mean"),
distance.matrix = distance_matrix,
distance.thresholds = 0, #here we selected zero as in non-spatial model we found at multiple thresholds they all show auto-correlation
method = "mem.moran.sequential", #default method, you can select other methods too such as mem.effect.recursive, check help for details
ranger.arguments = list( #this part we keep same as non-spatial model
mtry = 3,
min.node.size = 5,
num.trees = 500
),
verbose = FALSE,
n.cores = parallel::detectCores() - 2,
seed = random.seed
)
#print the model result
spatialGreeneRF
VIPrep <- spatialRF::plot_importance(
spatialGreeneRF.repeat,
verbose = FALSE
)
PDP1 <- spatialRF::plot_response_curves(
spatialGreeneRF.repeat,
variables = c("Income_Sco", "Barriers_H", "Crime_Scor", "density_pp", "Green_avail", "PM10","NightLightmean", "RNoiseLmedian", "LSTSummer17mean"),
quantiles = 0.5,
ncol = 3,
verbose = TRUE
) +
ggplot2::ggtitle("Spatial RF")
PDP1 <- spatialRF::plot_response_curves(
spatialGreeneRF,
variables = c("Income_Sco", "Barriers_H", "Crime_Scor", "density_pp", "Green_avail", "PM10","NightLightmean", "RNoiseLmedian", "LSTSummer17mean"),
quantiles = 0.5,
ncol = 3,
verbose = TRUE
) +
ggplot2::ggtitle("Spatial RF")
PDP1 <- spatialRF::plot_response_curves(
spatialGreeneRF,
variables = c("Income_Sco", "Barriers_H", "Crime_Scor", "density_pp", "Green_avail", "PM10","NightLightmean", "RNoiseLmedian", "LSTSummer17mean"),
quantiles = 0.5,
ncol = 3,
verbose = TRUE
) +
ggplot2::ggtitle("Spatial RF")
PDP1
#This part we try to tune the hyper parameters of the fitted model
#It might take some time
spatialGreeneRF <- rf_tuning(
model = spatialGreeneRF,
xy = xy, #location indicating coordinates of each neighborhood
repetitions = 5, #times the tuning process will run, such as K fold CV, here 5 means we used 5 folds
num.trees = c(100, 1000), #the range within which the number of trees the model can select
mtry = seq(
2,
length(spatialGreeneRF$ranger.arguments$predictor.variable.names), #number of predictors
by = 9),
min.node.size = c(5, 15), #minimum rows the model can pick between 5 to 15
seed = random.seed,
n.cores = 2, #used for faster calculation, check how many cores your laptop has before selecting the core numbers
verbose = FALSE
)
#This part we try to tune the hyper parameters of the fitted model
#It might take some time
spatialGreeneRF_tune <- rf_tuning(
model = spatialGreeneRF,
xy = xy, #location indicating coordinates of each neighborhood
repetitions = 5, #times the tuning process will run, such as K fold CV, here 5 means we used 5 folds
num.trees = c(100, 1000), #the range within which the number of trees the model can select
mtry = seq(
2,
length(spatialGreeneRF$ranger.arguments$predictor.variable.names), #number of predictors
by = 9),
min.node.size = c(5, 15), #minimum rows the model can pick between 5 to 15
seed = random.seed,
n.cores = 2, #used for faster calculation, check how many cores your laptop has before selecting the core numbers
verbose = FALSE
)
setwd("C:\\Users\\jitse\\Documents\\GitHub\\Amsterdam_house_prices\\data")
library(tidyverse)
df <- read_csv("funda_buy_17-03-2023.csv")
model <- lm(data = df, price~room +living_area + house_age + house_type)
summary(model)
library(tidygeocoder)
df_new <- df %>%
top_n(10) %>%
mutate(adddreszip = paste0(address, ", Noord-Holland")) %>%
geocode(adddreszip, method = 'osm', lat = latitude , long = longitude)
easypackages::packages ("sf", "sp", "spdep", "spatialreg", "GWmodel", "tmap", "mapview", "car", "RColorBrewer",
"cowplot", "leafsync", "leaflet.extras2", "mapview", "tidyverse")
library(sf)
df_sp <- df_new %>% drop_na()
x = st_as_sf(df_sp, coords = c( "longitude", "latitude"), crs = 4326)
x <- st_transform(x, crs = 28992)
st_write(x, "test.gpkg")
library(sf)
df_sp <- df_new %>% drop_na()
x = st_as_sf(df_sp, coords = c( "longitude", "latitude"), crs = 4326)
x <- st_transform(x, crs = 28992)
st_write(x, "test.gpkg")
qtm(x)
greendata_sp <- as_Spatial(x)
#fit the adaptive kernel
#find adaptive kernel using gaussian function
abw <- bw.gwr(price~room +living_area + house_age,
approach = "AIC", #specified by CV for cross-validation approach or by AIC corrected (AICc), we used AIC
adaptive = TRUE,
kernel="gaussian", #this can be different function e.g., bisquare,exponential, depend on the prior understanding or choice of the modeler
data=greendata_sp) #give the sp data created earlier
#fitting the model with gwr.basic function
a.gwr <- gwr.basic(price~room +living_area + house_age, #the equation
adaptive = TRUE,
kernel="gaussian", #indicate the Kernel again
bw = 17, #give the optimal bandwidth we found in the last stage
data=greendata_sp)
#print the model result
a.gwr
multiGWR <- gwr.multiscale(price~room +living_area + house_age,
data = greendata_sp,
adaptive = T,
max.iterations = 10, #usually large number to make sure each variable converage to best bandwidth
criterion="CVR", #criterion for determining the convergence of the back-fitting procedure
kernel = "bisquare", #kernel can also be gaussian, exponential
bws0=c(10,10,10), #starting number of neighbors
verbose = F, predictor.centered=rep(T, 6))
multiGWR
df_new <- df %>%
top_n(1000) %>%
mutate(adddreszip = paste0(address, ", Noord-Holland")) %>%
geocode(adddreszip, method = 'osm', lat = latitude , long = longitude)
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(leaflet)
df <- read.csv('data/test/funda_buy_21-03-2023(sample100p)')
knitr::opts_chunk$set(echo = TRUE)
df <- read.csv('data/test/funda_buy_21-03-2023(sample100p).csv')
leaflet(df) %>% addTiles() %>%
addCircleMarkers(lng = ~longitude, lat = ~latitude,
popup = ~address)
df <- read.csv('data/test/funda_buy_21-03-2023(sample100p).csv')
leaflet(df) %>% addTiles() %>%
addCircleMarkers(lng = ~longitude, lat = ~latitude,
popup = ~address)
View(df_new)
write.csv(df_new, 'data/test/funda_buy_21-03-2023(sample100p)latlon.csv')
leaflet(df) %>% addTiles() %>%
addCircleMarkers(lng = ~longitude, lat = ~latitude,
popup = ~address)
df <- read.csv('data/test/funda_buy_21-03-2023(sample100p)latlon.csv')
leaflet(df) %>% addTiles() %>%
addCircleMarkers(lng = ~longitude, lat = ~latitude,
popup = ~address)
View(df_new)
knitr::opts_chunk$set(echo = TRUE)
easypackages::packages ("sf", "sp", "tmap", "mapview", "car", "RColorBrewer", "tidyverse", "osmdata", "nngeo", "FNN", "rpart", "rpart.plot", "sessioninfo", "caret", "rattle", "ipred", "tidymodels", "ranger", "modelStudio", "DALEX", "DALEXtra", "vip", "pdp", "rgeos", "spatialRF")
easypackages::packages("sf", "sp", "osmdata", "FNN", "tidyverse")
easypackages::packages("sf", "sp", "osmdata", "FNN", "tidyverse")
province_boundaries <- st_read ("data/Noord_Holland.gpkg")
funda_data <- st_read ("data/funda_buy_28-03-2023_full.gpkg")
# Get OSM data
bus <-  opq(st_bbox(province_boundaries)) %>%
add_osm_feature(key = "amenity", c("bus_station")) %>%
osmdata_sf ()
easypackages::packages("tidyverse", "sf", "mapview", "RColorBrewer", "tmap", "car", "spdep", "spatialreg")
gwr_result<- st_read("data/gwr_result.gpkg")
gwr_result<- st_read("data/gwr_result_full.gpkg")
setwd("~/GitHub/Noord_Holland_house_prices")
gwr_result<- st_read("data/gwr_result_full.gpkg")
gwr_result<- st_read("data/gwr_results_full.gpkg")
gwr_result<- st_read("data/gwr_results_full.gpkg")
View(gwr_result)
gwr_result<- st_read("data/gwr_results_full.gpkg")
gwr_result<- st_read("data/gwr_results_full.gpkg")
bus <- gwr_result(gwr_result, zcol = "bus_dist", col.regions=brewer.pal(9, "YlOrRd"))
train <- gwr_result(gwr_result, zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
subway <- gwr_result(gwr_result, zcol = "subway_dist", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result<- st_read("data/gwr_results_full.gpkg")
bus <- gwr_result(gwr_result, zcol = "bus_dist", col.regions=brewer.pal(9, "YlOrRd"))
bus <- mapview(gwr_result, zcol = "bus_dist", col.regions=brewer.pal(9, "YlOrRd"))
train <- mapview(gwr_result, zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
subway <- mapview(gwr_result, zcol = "subway_dist", col.regions=brewer.pal(9, "YlOrRd"))
sync(bus,train,subway)
sync(bus,train,subway)
easypackages::packages("tidyverse", "sf", "mapview", "RColorBrewer", "tmap", "car", "spdep", "spatialreg", "leafsync")
gwr_result<- st_read("data/gwr_results_full.gpkg")
bus <- mapview(gwr_result, zcol = "bus_dist", col.regions=brewer.pal(9, "YlOrRd"))
train <- mapview(gwr_result, zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
subway <- mapview(gwr_result, zcol = "subway_dist", col.regions=brewer.pal(9, "YlOrRd"))
sync(bus,train,subway)
bus <- mapview(gwr_result, zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
train <- mapview(gwr_result, zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
subway <- mapview(gwr_result, zcol = "subway_dist", col.regions=brewer.pal(9, "YlOrRd"))
sync(bus,train,subway)
bus
View(gwr_result)
bus <- mapview(gwr_result, zcol = "residual", col.regions=brewer.pal(9, "YlOrRd"))
train <- mapview(gwr_result, zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
subway <- mapview(gwr_result, zcol = "subway_dist", col.regions=brewer.pal(9, "YlOrRd"))
bus
View(gwr_result)
bus <- mapview(gwr_result, zcol = "university_dist", col.regions=brewer.pal(9, "YlOrRd"))
bus
gwr_result %>%
ggplot(aes(x = residual)) + geom_density2d()
gwr_result %>%
ggplot(aes(x = residual)) + geom_density()
gwr_result %>%
ggplot(aes(x = residual)) + geom_histogram()
gwr_result %>%
ggplot(aes(x = residual)) + geom_density()
bus <- mapview(gwr_result, zcol = "room", col.regions=brewer.pal(9, "YlOrRd"))
map <- mapview(gwr_result, zcol = "room", col.regions=brewer.pal(9, "YlOrRd"))
map
map <- mapview(gwr_result, zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
map
map <- mapview(gwr_result, zcol = "living_area_TV", col.regions=brewer.pal(9, "YlOrRd"))
map
map <- mapview(gwr_result, zcol = "room", col.regions=brewer.pal(9, "YlOrRd"))
map
map <- mapview(gwr_result, zcol = "house_age", col.regions=brewer.pal(9, "YlOrRd"))
map
easypackages::packages("tidyverse", "sf", "mapview", "RColorBrewer", "tmap", "car", "spdep", "spatialreg", "leafsync")
#load data
funda_data <- st_read("data/funda_buy_amsterdam_31-03-2023_full_distances.gpkg")
PC4 <- st_transform(st_read("data/Amsterdam/PC4.json"), crs = 28992)
#plot dependent variable
mapview(funda_data, zcol = "price", col.regions=brewer.pal(9, "YlOrRd"))
tm_shape(PC4)+
tm_polygons()+
tm_shape(funda_data)+
tm_dots(c("price"), style = "log10_pretty") +
tm_layout(legend.position = c("right", "top"),
legend.text.size = 0.5, legend.title.size = 0.8)
gwr_result<- st_read("data/gwr_results_amsterdam.gpkg")
map <- mapview(gwr_result, zcol = "house_age", col.regions=brewer.pal(9, "YlOrRd"))
map
map <- mapview(gwr_result, zcol = "tram", col.regions=brewer.pal(9, "YlOrRd"))
map
map <- mapview(gwr_result, zcol = "metro", col.regions=brewer.pal(9, "YlOrRd"))
map
gwr_result %>%
filter(metro_TV < -1.96| metro_TV > 1.96) %>%
mapview( zcol = "metro", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(tram_TV < -1.96| tram_TV > 1.96) %>%
mapview( zcol = "tram", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(metro_TV < -1.96| metro_TV > 1.96) %>%
mapview( zcol = "metro", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
#filter(metro_TV < -1.96| metro_TV > 1.96) %>%
mapview( zcol = "metro", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
#filter(metro_TV < -1.96| metro_TV > 1.96) %>%
mapview( zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(living_area_TV < -1.96| living_area_TV > 1.96) %>%
mapview( zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
ggplot(aes(x = residual)) + geom_density()
equation <- price ~ room + bedroom + bathroom + living_area + house_age + tram + metro
#OLS
model <- lm(equation,
data = funda_data)
summary(model)
trein <- st_transform(st_read("data/Amsterdam/Stations_(NS).geojson"), crs= 28992)
View(trein)
##### Amsterdam
nn_function <- function(measureFrom,measureTo,k) {
measureFrom_Matrix <- as.matrix(measureFrom)
measureTo_Matrix <- as.matrix(measureTo)
nn <-
get.knnx(measureTo, measureFrom, k)$nn.dist [,k]
return(nn)
}
amsterdam_boundaries <- st_transform(st_read("data/Amsterdam/PC4.json"), crs= 28992)
amsterdam_network <- st_transform(st_read("data/Amsterdam/streets.json"), crs= 28992)
public_transport <- st_transform(st_read("data/Amsterdam/public_transport.json"), crs= 28992)
trein <- st_transform(st_read("data/Amsterdam/Stations_(NS).geojson"), crs= 28992)
tram <- public_transport %>%
filter(Modaliteit == "Tram")
metro <- public_transport %>%
filter(Modaliteit == "Metro")
funda_data <- st_read ("data/funda_buy_amsterdam_31-03-2023_full.gpkg")
funda_data <- funda_data %>%
mutate(tram_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(tram$geometry), 1))
funda_data <- funda_data %>%
mutate(metro_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(metro$geometry), 1))
funda_data <- funda_data %>%
mutate(metro_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(metro$geometry), 1))
funda_data <- funda_data %>%
mutate(train_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(trein$geometry), 1))
#write results to updated gpkg
st_write(funda_data, "data/funda_buy_amsterdam_31-03-2023_full_distances.gpkg")
easypackages::packages("sf", "sp", "osmdata", "FNN", "tidyverse")
##### Amsterdam
nn_function <- function(measureFrom,measureTo,k) {
measureFrom_Matrix <- as.matrix(measureFrom)
measureTo_Matrix <- as.matrix(measureTo)
nn <-
get.knnx(measureTo, measureFrom, k)$nn.dist [,k]
return(nn)
}
amsterdam_boundaries <- st_transform(st_read("data/Amsterdam/PC4.json"), crs= 28992)
amsterdam_network <- st_transform(st_read("data/Amsterdam/streets.json"), crs= 28992)
public_transport <- st_transform(st_read("data/Amsterdam/public_transport.json"), crs= 28992)
trein <- st_transform(st_read("data/Amsterdam/Stations_(NS).geojson"), crs= 28992)
tram <- public_transport %>%
filter(Modaliteit == "Tram")
metro <- public_transport %>%
filter(Modaliteit == "Metro")
funda_data <- st_read ("data/funda_buy_amsterdam_31-03-2023_full.gpkg")
funda_data <- funda_data %>%
mutate(tram_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(tram$geometry), 1))
funda_data <- funda_data %>%
mutate(metro_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(metro$geometry), 1))
funda_data <- funda_data %>%
mutate(metro_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(metro$geometry), 1))
funda_data <- funda_data %>%
mutate(train_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(trein$geometry), 1))
#write results to updated gpkg
st_write(funda_data, "data/funda_buy_amsterdam_31-03-2023_full_distances.gpkg")
##### Amsterdam
nn_function <- function(measureFrom,measureTo,k) {
measureFrom_Matrix <- as.matrix(measureFrom)
measureTo_Matrix <- as.matrix(measureTo)
nn <-
get.knnx(measureTo, measureFrom, k)$nn.dist [,k]
return(nn)
}
amsterdam_boundaries <- st_transform(st_read("data/Amsterdam/PC4.json"), crs= 28992)
amsterdam_network <- st_transform(st_read("data/Amsterdam/streets.json"), crs= 28992)
public_transport <- st_transform(st_read("data/Amsterdam/public_transport.json"), crs= 28992)
trein <- st_transform(st_read("data/Amsterdam/Stations_(NS).geojson"), crs= 28992)
tram <- public_transport %>%
filter(Modaliteit == "Tram")
metro <- public_transport %>%
filter(Modaliteit == "Metro")
funda_data <- st_read ("data/funda_buy_amsterdam_31-03-2023_full.gpkg")
funda_data <- funda_data %>%
mutate(tram_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(tram$geometry), 1))
funda_data <- funda_data %>%
mutate(metro_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(metro$geometry), 1))
funda_data <- funda_data %>%
mutate(metro_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(metro$geometry), 1))
funda_data <- funda_data %>%
mutate(train_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(trein$geometry), 1))
#write results to updated gpkg
st_write(funda_data, "data/funda_buy_amsterdam_31-03-2023_full_distances.gpkg")
gwr_result<- st_read("data/gwr_results_amsterdam.gpkg")
gwr_result %>%
filter(train_dist_TV < -1.96| train_dist_TV > 1.96) %>%
mapview( zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
easypackages::packages("sf", "sp", "osmdata", "FNN", "tidyverse")
province_boundaries <- st_read ("data/Noord_Holland.gpkg")
funda_data <- st_read ("data/funda_buy_28-03-2023_full.gpkg")
trein <- st_transform(st_read("data/Amsterdam/Stations_(NS).geojson"), crs= 28992)
#This function take an origin point (from), and a destination point (to), and then use nn function of FNN package to estimate the distance to the nearest (k =1) neighborhood location
nn_function <- function(measureFrom,measureTo,k) {
measureFrom_Matrix <- as.matrix(measureFrom)
measureTo_Matrix <- as.matrix(measureTo)
nn <-
get.knnx(measureTo, measureFrom, k)$nn.dist [,k]
return(nn)
}
#distance to train station
funda_data <- funda_data %>%
mutate(train_dist = nn_function(st_coordinates(funda_data$geom), st_coordinates(trein$geometry), 1))
#write results to updated gpkg
st_write(funda_data, "data/funda_buy_28-03-2023_full_distances.gpkg")
#write results to updated gpkg
st_write(funda_data, "data/funda_buy_28-03-2023_full_distances.gpkg")
gwr_result<- st_read("data/gwr_results_full.gpkg")
gwr_result %>%
filter(train_dist_TV < -1.96| train_dist_TV > 1.96) %>%
mapview( zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
View(gwr_result)
gwr_result %>%
ggplot(aes(x = yhat+residual)) + geom_density()
gwr_result<- st_read("data/gwr_results_full.gpkg")
gwr_result %>%
filter(train_dist_TV < -1.96| train_dist_TV > 1.96) %>%
mapview( zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(train_dist_TV < -1.96| train_dist_TV > 1.96) %>%
mapview( zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result<- st_read("data/gwr_results_amsterdam.gpkg")
gwr_result %>%
ggplot(aes(x = yhat+residual)) + geom_density()
gwr_result<- st_read("data/gwr_results_amsterdam.gpkg")
gwr_result %>%
ggplot(aes(x = yhat+residual)) + geom_density()
gwr_result<- st_read("data/gwr_results_amsterdam.gpkg")
gwr_result %>%
ggplot(aes(x = yhat+residual)) + geom_density()
gwr_result %>%
filter(train_dist_TV < -1.96| train_dist_TV > 1.96) %>%
mapview( zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
ggplot(aes(x = yhat+residual)) + geom_density()
gwr_result %>%
filter(metro_dist_TV < -1.96| metro_dist_TV > 1.96) %>%
mapview( zcol = "metro_dist", col.regions=brewer.pal(9, "YlOrRd"))
View(gwr_result)
gwr_result<- st_read("data/gwr_results_amsterdam.gpkg")
gwr_result %>%
filter(metro_dist_TV < -1.96| metro_d > 1.96) %>%
mapview( zcol = "metro_dist", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(metro_dist_TV < -1.96| metro_dist > 1.96) %>%
mapview( zcol = "metro_dist", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(metro_dist_TV < -1.96| metro_dist_TV > 1.96) %>%
mapview( zcol = "metro_dist", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(tram_dist_TV < -1.96| tram_dist_TV > 1.96) %>%
mapview( zcol = "tram_dist", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(train_dist_TV < -1.96| train_dist_TV > 1.96) %>%
mapview( zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(living_area_TV < -1.96| living_area_TV > 1.96) %>%
mapview( zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
st_bbox(PC4)
easypackages::packages("tidyverse", "sf", "mapview", "RColorBrewer", "tmap")
#Visualize results GWR model
gwr_result<- st_read("data/gwr_results_amsterdam.gpkg")
gwr_result %>%
filter(living_area_TV < -1.96| living_area_TV > 1.96) %>%
mapview( zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
map <- mapview(gwr_result, zcol = "metro", col.regions=brewer.pal(9, "YlOrRd"))
map
#Visualize results GWR model
gwr_result<- st_read("data/gwr_results_amsterdam.gpkg")
gwr_result %>%
filter(living_area_TV < -1.96| living_area_TV > 1.96) %>%
mapview( zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
tm_shape(PC4)+
tm_polygons()+
tm_shape(gwr_result)+
tm_dots(c("train_dist"), style = "log10_pretty") +
tm_layout(legend.position = c("right", "top"),
legend.text.size = 0.5, legend.title.size = 0.8)
tm_shape(PC4)+
tm_polygons()+
tm_shape(gwr_result)+
tm_dots(c("train_dist")) +
tm_layout(legend.position = c("right", "top"),
legend.text.size = 0.5, legend.title.size = 0.8)
gwr_result %>%
filter(living_area_TV < -1.96| living_area_TV > 1.96) %>%
mapview( zcol = "living_area", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(train_dist_TV < -1.96| train_dist_TV > 1.96) %>%
mapview( zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
filter(metro_dist_TV < -1.96| metro_dist_TV > 1.96) %>%
mapview( zcol = "metro_dist", col.regions=brewer.pal(9, "YlOrRd"))
#Visualize results GWR model
gwr_result<- st_read("data/gwr_results_full.gpkg")
gwr_result %>%
filter(train_dist_TV < -1.96| train_dist_TV > 1.96) %>%
mapview( zcol = "train_dist", col.regions=brewer.pal(9, "YlOrRd"))
gwr_result %>%
#filter(train_dist_TV < -1.96| train_dist_TV > 1.96) %>%
mapview( zcol = "residual", col.regions=brewer.pal(9, "YlOrRd"))
equation <- price ~ room + bedroom + bathroom + living_area + house_age + tram_dist + metro_dist
#OLS
model <- lm(equation,
data = funda_data)
summary(model)
funda_data$res_lm <- model$residuals
#Now plot the residuals
mapview(funda_data, zcol = "res_lm", col.regions=brewer.pal(9, "YlOrRd"))
easypackages::packages("tidyverse", "sf", "mapview", "RColorBrewer", "tmap", "car", "spdep", "spatialreg", "leafsync")
#load data
funda_data <- st_read("data/funda_buy_amsterdam_31-03-2023_full_distances.gpkg")
equation <- price ~ room + bedroom + bathroom + living_area + house_age + tram_dist + metro_dist
#OLS
model <- lm(equation,
data = funda_data)
summary(model)
funda_data$res_lm <- model$residuals
#Now plot the residuals
mapview(funda_data, zcol = "res_lm", col.regions=brewer.pal(9, "YlOrRd"))
funda_data <- st_read("data/funda_buy_amsterdam_31-03-2023_full_distances.gpkg")
PC4 <- st_transform(st_read("data/Amsterdam/PC4.json"), crs = 28992)
tm_shape(PC4)+
tm_polygons()+
tm_shape(gwr_result)+
tm_dots(c("train_dist")) +
tm_layout(legend.position = c("right", "top"),
legend.text.size = 0.5, legend.title.size = 0.8)
